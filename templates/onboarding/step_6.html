{% extends "onboarding/wizard_base.html" %}
{% load form_tags %}
{% block wizard_title %}Review & Launch Your Plan{% endblock %}
{% block back_url %}{% url 'onboarding:step_5' %}{% endblock %}
{% block submit_text %}Generate My Plan{% endblock %}

{% block wizard_content %}
<div class="card mb-3">
    <div class="card-header fw-bold">Business Basics</div>
    <div class="card-body">
        <p><strong>Name:</strong> {{ data.business_name }}</p>
        <p><strong>Type:</strong> {{ data.business_type }}</p>
        <p><strong>Stage:</strong> {{ data.stage }}</p>
        <p><strong>Model:</strong> {{ data.business_model|default:"Not specified" }}</p>
        {% if data.niche %}<p><strong>Niche:</strong> {{ data.niche }}</p>{% endif %}
        {% if data.description %}<p><strong>Description:</strong> {{ data.description }}</p>{% endif %}
        {% if data.current_revenue %}<p><strong>Revenue:</strong> {{ data.current_revenue }}</p>{% endif %}
        {% if data.team_size %}<p><strong>Team:</strong> {{ data.team_size }}</p>{% endif %}
        {% if data.biggest_challenges %}<p class="mb-0"><strong>Challenges:</strong> {{ data.biggest_challenges }}</p>{% endif %}
    </div>
</div>

{% if goals_list %}
<div class="card mb-3">
    <div class="card-header fw-bold">Goals</div>
    <div class="card-body">
        <ul class="mb-0">
            {% for goal in goals_list %}<li>{{ goal }}</li>{% endfor %}
        </ul>
    </div>
</div>
{% endif %}

<div class="card mb-3">
    <div class="card-header fw-bold">Your Profile</div>
    <div class="card-body">
        <p><strong>Experience:</strong> {{ data.business_experience|default:"Not specified" }}</p>
        <p><strong>Hours/day:</strong> {{ data.hours_per_day|default:"2" }}</p>
        {% if skills_display %}
        <p><strong>Skills:</strong> {{ skills_display|join:", " }}</p>
        {% endif %}
        {% if data.education_background %}
        <p><strong>Education:</strong> {{ data.education_background }}</p>
        {% endif %}
    </div>
</div>

<div class="card mb-3">
    <div class="card-header fw-bold">Digital Presence</div>
    <div class="card-body">
        <ul class="mb-0">
            <li>Website: {% if data.has_website %}Yes{% else %}No{% endif %}</li>
            <li>Domain: {% if data.has_domain %}Yes{% else %}No{% endif %}</li>
            <li>Branding: {% if data.has_branding %}Yes{% else %}No{% endif %}</li>
            <li>Email list: {% if data.has_email_list %}Yes{% else %}No{% endif %}</li>
            {% if platforms_display %}
            <li>Social media: {{ platforms_display|join:", " }}</li>
            {% else %}
            <li>Social media: None yet</li>
            {% endif %}
        </ul>
    </div>
</div>

<div class="card mb-3">
    <div class="card-body">
        <p><strong>Budget:</strong> {{ data.budget_range|default:"Not specified" }}</p>
        <p class="mb-0"><strong>Location:</strong> {{ data.location|default:"Not specified" }}</p>
    </div>
</div>

<div class="alert alert-info">
    Clicking "Generate My Plan" will create a personalized 30-day action plan with templates, checklists, and guides tailored to your business. This may take a moment.
</div>

<!-- Loading overlay (hidden by default) -->
<div id="loading-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:9999; justify-content:center; align-items:center; flex-direction:column;">
    <div class="spinner-border text-primary mb-3" style="width:3rem; height:3rem;" role="status">
        <span class="visually-hidden">Loading...</span>
    </div>
    <h5>Generating your personalized plan...</h5>
    <p class="text-muted">Analyzing your business profile and creating tasks with resources. This usually takes 15-30 seconds.</p>
</div>

<script>
document.querySelector('form').addEventListener('submit', function(e) {
    var overlay = document.getElementById('loading-overlay');
    overlay.style.display = 'flex';
    // Disable submit button to prevent double-click
    var btn = this.querySelector('button[type="submit"]');
    btn.disabled = true;
    btn.textContent = 'Generating...';
});
</script>
{% endblock %}
