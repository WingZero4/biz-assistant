{% extends "base.html" %}
{% block title %}Dashboard — BizAssistant{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0">Dashboard</h2>
    <a href="{% url 'accounts:assessment' %}" class="btn btn-outline-primary btn-sm">View Assessment</a>
</div>

{% if plan %}
<!-- Progress -->
<div class="card mb-4">
    <div class="card-body">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title mb-0">{{ plan.title }}</h5>
            <span class="badge bg-primary">{{ plan.completion_pct }}% complete</span>
        </div>
        <div class="progress" style="height: 12px;">
            <div class="progress-bar bg-success" style="width: {{ plan.completion_pct }}%"></div>
        </div>
        <small class="text-muted">{{ plan.starts_on }} — {{ plan.ends_on }}</small>
    </div>
</div>

<!-- Stats -->
{% if stats %}
<div class="row mb-4 g-3">
    <div class="col-6 col-md-3">
        <div class="card text-center h-100">
            <div class="card-body py-3">
                <h4 class="text-success mb-0">{{ stats.done }}</h4>
                <small class="text-muted">Completed</small>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card text-center h-100">
            <div class="card-body py-3">
                <h4 class="mb-0">{{ stats.remaining }}</h4>
                <small class="text-muted">Remaining</small>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card text-center h-100">
            <div class="card-body py-3">
                <h4 class="text-warning mb-0">{{ stats.skipped }}</h4>
                <small class="text-muted">Skipped</small>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card text-center h-100">
            <div class="card-body py-3">
                <h4 class="{% if stats.overdue %}text-danger{% else %}text-muted{% endif %} mb-0">{{ stats.overdue }}</h4>
                <small class="text-muted">Overdue</small>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Today's Tasks -->
<h4 class="mb-3">Today's Tasks ({{ today }})</h4>
{% if today_tasks %}
{% for task in today_tasks %}
<div class="card mb-2">
    <div class="card-body d-flex justify-content-between align-items-center">
        <div>
            <h6 class="mb-1">
                <a href="{% url 'tasks:detail' task.pk %}">{{ task.title }}</a>
            </h6>
            <small class="text-muted">
                <span class="badge bg-secondary">{{ task.get_category_display }}</span>
                <span class="badge bg-info">{{ task.get_difficulty_display }}</span>
                ~{{ task.estimated_minutes }} min
            </small>
        </div>
        <div>
            <form method="post" action="{% url 'tasks:mark_done' task.pk %}" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="next" value="{% url 'accounts:dashboard' %}">
                <button type="submit" class="btn btn-sm btn-success">Done</button>
            </form>
            <form method="post" action="{% url 'tasks:mark_skip' task.pk %}" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="next" value="{% url 'accounts:dashboard' %}">
                <button type="submit" class="btn btn-sm btn-outline-warning">Skip</button>
            </form>
        </div>
    </div>
</div>
{% endfor %}
{% else %}
<div class="alert alert-success">No pending tasks for today. Great job!</div>
{% endif %}

<!-- Recently Completed -->
{% if recent_completed %}
<h5 class="mt-4 mb-3">Recently Completed</h5>
<ul class="list-group mb-4">
    {% for task in recent_completed %}
    <li class="list-group-item d-flex justify-content-between">
        <span><s>{{ task.title }}</s></span>
        <small class="text-muted">Day {{ task.day_number }}</small>
    </li>
    {% endfor %}
</ul>
{% endif %}

<!-- Upcoming -->
{% if upcoming_tasks %}
<h5 class="mt-4 mb-3">Coming Up</h5>
<ul class="list-group">
    {% for task in upcoming_tasks %}
    <li class="list-group-item d-flex justify-content-between">
        <span>{{ task.title }}</span>
        <small class="text-muted">{{ task.due_date }}</small>
    </li>
    {% endfor %}
</ul>
{% endif %}

{% else %}
<div class="alert alert-info">
    You don't have an active plan yet.
    <a href="{% url 'onboarding:step_1' %}">Start onboarding</a> to get your personalized plan.
</div>
{% endif %}
{% endblock %}
